<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users - Task Tracker</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<nav class="navbar">
    <div class="nav-container">
        <h1 class="logo">ðŸ“‹ Task Tracker</h1>
        <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="users.html" class="active">Users</a></li>
            <li><a href="projects.html">Projects</a></li>
            <li><a href="tasks.html">Tasks</a></li>
        </ul>
    </div>
</nav>

<div class="container">
    <div id="alertContainer"></div>

    <div class="card">
        <h2>Users Management</h2>
        <button class="btn btn-primary" onclick="toggleForm()">+ Create New User</button>
    </div>

    <!-- Create User Form -->
    <div id="userForm" class="card" style="display: none; margin-top: 20px;">
        <h3>Create New User</h3>
        <form onsubmit="createUser(event)">
            <div class="form-group">
                <label>Username *</label>
                <input type="text" id="username" required minlength="3">
            </div>
            <div class="form-group">
                <label>Email *</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label>Password *</label>
                <input type="password" id="password" required minlength="8">
            </div>
            <button type="submit" class="btn btn-success">Create User</button>
            <button type="button" class="btn btn-secondary" onclick="toggleForm()">Cancel</button>
        </form>
    </div>

    <!-- Users List -->
    <div id="usersList" style="margin-top: 20px;">
        <div class="loading">Loading users...</div>
    </div>

    <!-- Pagination -->
    <div id="pagination" class="pagination"></div>
</div>

<script>
    const API_BASE = 'http://localhost:8080/api';
    let currentPage = 0;

    // Load users on page load
    document.addEventListener('DOMContentLoaded', () => {
        loadUsers();
    });

    function toggleForm() {
        const form = document.getElementById('userForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
        if (form.style.display === 'none') {
            document.getElementById('username').value = '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }
    }

    async function loadUsers(page = 0) {
        try {
            const response = await axios.get(`${API_BASE}/users`, {
                params: { page, size: 10 }
            });

            const data = response.data;
            const usersList = document.getElementById('usersList');

            if (data.content.length === 0) {
                usersList.innerHTML = '<div class="empty-state"><h3>No users found</h3><p>Create your first user to get started</p></div>';
                return;
            }

            usersList.innerHTML = data.content.map(user => `
                <div class="list-item">
                    <h3>${user.username}</h3>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>User ID:</strong> ${user.id}</p>
                </div>
            `).join('');

            renderPagination(data);
            currentPage = page;
        } catch (error) {
            showAlert('Failed to load users: ' + error.message, 'error');
        }
    }

    async function createUser(event) {
        event.preventDefault();

        const userData = {
            username: document.getElementById('username').value,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value
        };

        try {
            await axios.post(`${API_BASE}/users`, userData);
            showAlert('User created successfully!');
            toggleForm();
            loadUsers(currentPage);
        } catch (error) {
            showAlert('Failed to create user: ' + (error.response?.data?.message || error.message), 'error');
        }
    }

    function renderPagination(data) {
        const pagination = document.getElementById('pagination');
        if (data.totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let html = '';
        if (data.number > 0) {
            html += `<button class="btn btn-secondary" onclick="loadUsers(${data.number - 1})">Previous</button>`;
        }

        html += `<span style="padding: 10px;">Page ${data.number + 1} of ${data.totalPages}</span>`;

        if (data.number < data.totalPages - 1) {
            html += `<button class="btn btn-secondary" onclick="loadUsers(${data.number + 1})">Next</button>`;
        }

        pagination.innerHTML = html;
    }

    function showAlert(message, type = 'success') {
        const alertContainer = document.getElementById('alertContainer');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.textContent = message;
        alertContainer.appendChild(alert);

        setTimeout(() => alert.remove(), 5000);
    }
</script>
</body>
</html>